
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <base href="/" />
  <title>Painel DO-AGA • OLS</title>
  <link rel="stylesheet" href="./styles.css" />
  <style>
    /* sem alteração de identidade visual: apenas layout mínimo para o módulo */
    .ols-wrap { display: grid; grid-template-columns: 420px 1fr; gap: 8px; height: calc(100vh - 120px); }
    .ols-form { overflow: auto; padding: 8px; border: 1px solid #ddd; border-radius: 8px; }
    .ols-view { display: grid; grid-template-rows: 1fr 1fr; gap: 8px; }
    #plan2d, #view3d { border: 1px solid #ddd; border-radius: 8px; background: #fff; }
    fieldset{border:1px solid #ccc; border-radius:6px;padding:8px;margin-bottom:8px}
    label{display:block;font-size:12px;margin-top:6px}
    input, select{width:100%;padding:6px;border:1px solid #ccc;border-radius:4px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .muted{opacity:.7}
  </style>

  <!-- App config / sessão / cliente supabase (já usados no app) -->
  <script src="./config.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js" defer></script>
  <script src="./supabaseClient.js" defer></script>
  <script src="./auth-ready.js" defer></script>
  <script src="./safety-guards.js" defer></script>
  <script src="./mpa.js" defer></script>
  <!-- libs apenas para este módulo -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.158/examples/js/controls/OrbitControls.js"></script>
  <!-- módulo -->
  <script src="./utils.js"></script>
  <script src="./modules/ols-geom.js"></script>
  <script src="./modules/ols-3d.js"></script>
  <script src="./modules/ols.js" defer></script>
</head>
<body>
  <div class="app">
    <header class="bar head">
      <div class="lhs">
        <a href="./dashboard.html" class="appTitle">Painel DO-AGA</a>
        <nav class="crumbs muted">OLS</nav>
      </div>
      <div class="rhs">
        <span id="userName"></span> • <span id="userRole"></span>
      </div>
    </header>

    <main class="ols-wrap">
      <section class="ols-form">
        <h3>Parâmetros do aeródromo (hipotético)</h3>
        <fieldset>
          <legend>Pista</legend>
          <div class="row">
            <label>Título/Identificador <input id="rwylbl" value="RWY 09/27"></label>
            <label>Classe de aproximação
              <select id="class">
                <option value="non-instrument">Não-instrumento</option>
                <option value="non-precision">Não-precisão</option>
                <option value="catI" selected>Precisão CAT I</option>
                <option value="catII">Precisão CAT II/III</option>
              </select>
            </label>
          </div>
          <div class="row">
            <label>Code number (1–4) <input type="number" id="code" min="1" max="4" step="1" value="4"></label>
            <label>Largura da pista (m) <input type="number" id="rwyw" value="45"></label>
          </div>
          <div class="row">
            <label>Comprimento da pista (m) <input type="number" id="rwyl" value="2500"></label>
            <label>Declividade longitudinal (%) <input type="number" id="slope" value="0"></label>
          </div>
          <div class="row">
            <label>Elevação THR A (m) <input type="number" id="thrA_elev" value="100"></label>
            <label>Elevação THR B (m) <input type="number" id="thrB_elev" value="103"></label>
          </div>
          <div class="row">
            <label>Ângulo de rumo da pista (graus, a partir do Norte) <input type="number" id="heading" min="0" max="360" value="90"></label>
            <label>Escala planta (m por unidade) <input type="number" id="scale" value="1"></label>
          </div>
        </fieldset>

        <fieldset>
          <legend>Coordenadas (planta cartesiana)</legend>
          <div class="row">
            <label>X do ponto médio (m) <input type="number" id="cx" value="0"></label>
            <label>Y do ponto médio (m) <input type="number" id="cy" value="0"></label>
          </div>
          <div class="row">
            <label>Carregar obstáculos (GeoJSON) <input type="file" id="obstacles" accept=".geojson,.json"></label>
            <label class="muted">Campo de altura esperado: <code>elev</code> (m AMSL) ou <code>height</code> (m AGL)</label>
          </div>
        </fieldset>

        <button id="btnDraw">Desenhar / Atualizar</button>
        <span class="muted">Dica: passe o mouse sobre as superfícies para ver os rótulos.</span>
      </section>

      <section class="ols-view">
        <canvas id="plan2d"></canvas>
        <div id="view3d"></div>
      </section>
    </main>

    <footer class="bar foot">
      <span>Retro-UI</span>
      <span>© DO-AGA</span>
      <span id="footBuild"></span>
    </footer>
  </div>
  <script defer src="./build-info-client.js"></script>
</body>
</html>
